import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { ArrowLeft, Brain, Target, Lightbulb } from 'lucide-react';

interface LeapOfFaithBuilderProps {
  cpsData: {
    customer: string;
    problem: string;
    solution: string;
  };
  onBack: () => void;
  onNext: () => void;
}

interface AssumptionAnalysis {
  assumptions: string[];
  isAnalyzing: boolean;
}

const LeapOfFaithBuilder = ({ cpsData, onBack, onNext }: LeapOfFaithBuilderProps) => {
  const [selectedCircle, setSelectedCircle] = useState<string | null>(null);
  const [analysis, setAnalysis] = useState<AssumptionAnalysis>({
    assumptions: [],
    isAnalyzing: false
  });

  const handleCircleClick = async (circleType: string) => {
    setSelectedCircle(circleType);
    setAnalysis({ assumptions: [], isAnalyzing: true });

    // Simulate AI analysis
    setTimeout(() => {
      const mockOutput = generateMockOutput(cpsData, circleType);
      setAnalysis({
        assumptions: mockOutput,
        isAnalyzing: false
      });
    }, 2000);
  };

  const generateMockOutput = (data: any, type: string) => {
    if (type === 'leap-of-faith') {
      // Generate Leap of Faith Assumptions
      return [
        `[LOFA #1]: ${data.customer} are actively seeking solutions to ${data.problem.toLowerCase()}.`,
        `[LOFA #2]: ${data.customer} are willing to adopt and pay for ${data.solution.toLowerCase()}.`,
        `[LOFA #3]: ${data.solution} will effectively solve the core pain points better than existing alternatives.`
      ];
    } else if (type === 'hypothesis') {
      // Generate Respective Hypotheses
      return [
        `Hypothesis 1: We believe that ${data.customer.toLowerCase()} will actively try new solutions if they reduce friction in ${data.problem.toLowerCase()}.`,
        `Hypothesis 2: We believe that ${data.customer.toLowerCase()} will adopt ${data.solution.toLowerCase()} because it addresses their specific pain points more effectively than current alternatives.`,
        `Hypothesis 3: We believe that ${data.customer.toLowerCase()} using ${data.solution.toLowerCase()} will see measurable improvements in their workflow because it reduces complexity and increases efficiency.`
      ];
    } else {
      // Default assumption analysis for other circles
      return [
        `Analysis for ${type}: This component focuses on validating key aspects of your business model.`,
        `Key insight: Understanding how this relates to your customer-problem-solution fit is crucial.`,
        `Recommendation: Consider how this element can be measured and validated through customer feedback.`
      ];
    }
  };

  const circles = [
    {
      id: 'leap-of-faith',
      title: 'Leap of Faith',
      icon: Target,
      position: 'top-8 left-8',
      color: 'construction-yellow'
    },
    {
      id: 'hypothesis',
      title: 'Respective Hypothesis',
      icon: Lightbulb,
      position: 'top-8 right-8',
      color: 'construction-green'
    },
    {
      id: 'assumption',
      title: 'Assumption',
      icon: Brain,
      position: 'bottom-20 left-1/2 transform -translate-x-1/2',
      color: 'construction-orange'
    }
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-background via-background to-muted/20 relative overflow-hidden">
      {/* Blueprint grid background */}
      <div 
        className="absolute inset-0 opacity-10 pointer-events-none"
        style={{
          backgroundImage: `
            linear-gradient(hsl(var(--blueprint-blue)) 1px, transparent 1px),
            linear-gradient(90deg, hsl(var(--blueprint-blue)) 1px, transparent 1px)
          `,
          backgroundSize: '40px 40px'
        }}
      />

      <div className="relative z-10 container mx-auto px-4 py-8">
        {/* Header */}
        <div className="text-center mb-12">
          <h1 className="text-4xl font-bold mb-4 text-foreground">
            Hypothesis Validation Framework
          </h1>
          <div className="max-w-4xl mx-auto space-y-4 text-muted-foreground">
            <p className="text-lg">
              Welcome to your Hypothesis Validation Framework! ðŸŽ‰
            </p>
            <p>
              This is where we start turning your ideas into testable assumptions. You'll dive into your leap of faith assumptionsâ€”those core beliefs that, if wrong, could jeopardize your entire business idea. Click on any of the circles to explore each step and get insights generated by our AI Lean Startup Strategist. Don't worry, we've got your back!
            </p>
            <p className="font-semibold">
              Start by clicking through to identify those leap-of-faith assumptions. These assumptions are critical to moving your idea forward with confidence!
            </p>
          </div>
        </div>

        {/* Interactive Circles */}
        <div className="relative h-[500px] mb-12">
          
          {circles.map((circle) => {
            const IconComponent = circle.icon;
            return (
              <button
                key={circle.id}
                onClick={() => handleCircleClick(circle.id)}
                className={`absolute ${circle.position} w-48 h-48 rounded-full border-4 border-${circle.color} bg-background/90 backdrop-blur-sm hover:bg-${circle.color}/10 transition-all duration-300 hover:scale-105 flex flex-col items-center justify-center group shadow-xl animate-fade-in`}
                style={{ zIndex: 2 }}
              >
                <IconComponent className={`w-16 h-16 text-${circle.color} mb-3`} />
                <span className={`text-base font-semibold text-${circle.color} text-center leading-tight px-2`}>
                  {circle.title}
                </span>
              </button>
            );
          })}
        </div>

        {/* AI Analysis Section */}
        {selectedCircle && (
          <div className="bg-card/80 backdrop-blur-sm rounded-lg p-6 mb-8 border shadow-lg">
            <div className="flex items-center gap-2 mb-4">
              <Brain className="w-6 h-6 text-primary" />
              <h3 className="text-xl font-bold">
                {selectedCircle === 'leap-of-faith' && 'ðŸš€ Lean Startup Strategist - Leap of Faith Assumptions'}
                {selectedCircle === 'hypothesis' && 'ðŸ¤– Hypothesis Framer - Testable Hypotheses'}
                {selectedCircle === 'assumption' && 'ðŸš€ Your Lean Startup Strategist is here!'}
              </h3>
            </div>
            
            <div className="mb-6">
              {selectedCircle === 'leap-of-faith' && (
                <div>
                  <p className="text-muted-foreground mb-4">
                    <strong>Goal:</strong> Identify the most critical Leap of Faith Assumptions (LOFAs) that underpin your CPS logic, focusing on those that could cause the business to fail if proven false.
                  </p>
                  <p className="text-muted-foreground mb-4">
                    As an expert in hypothesis-driven entrepreneurship with deep understanding of Eric Ries' Lean Startup methodology, I specialize in helping early-stage founders break down their business ideas into testable assumptions.
                  </p>
                </div>
              )}
              
              {selectedCircle === 'hypothesis' && (
                <div>
                  <p className="text-muted-foreground mb-4">
                    <strong>Task:</strong> Convert high-level assumptions (Leap of Faith Assumptions) into specific, testable hypotheses that can guide customer discovery interviews and experiments.
                  </p>
                  <p className="text-muted-foreground mb-4">
                    I'm converting each assumption into a clear, falsifiable hypothesis using the format: "We believe that [customer segment] will [specific behavior] because [reason or pain point]."
                  </p>
                </div>
              )}
              
              {selectedCircle === 'assumption' && (
                <div>
                  <p className="text-muted-foreground mb-4">
                    Let's dig deep into your CPS (Customerâ€“Problemâ€“Solution) to extract key insights for your business validation.
                  </p>
                  <p className="text-muted-foreground mb-4">
                    We'll examine your customer, the problem, and the proposed solution to pinpoint critical elements that need validation.
                  </p>
                </div>
              )}
            </div>

            {analysis.isAnalyzing ? (
              <div className="flex items-center gap-2 text-muted-foreground">
                <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-primary"></div>
                {selectedCircle === 'leap-of-faith' && 'Analyzing Leap of Faith Assumptions...'}
                {selectedCircle === 'hypothesis' && 'Generating testable hypotheses...'}
                {selectedCircle === 'assumption' && 'Analyzing your assumptions...'}
              </div>
            ) : analysis.assumptions.length > 0 ? (
              <div>
                <h4 className="text-lg font-semibold mb-4">
                  {selectedCircle === 'leap-of-faith' && 'ðŸ§  Leap of Faith Assumptions Identified:'}
                  {selectedCircle === 'hypothesis' && 'ðŸ“‹ Testable Hypotheses Generated:'}
                  {selectedCircle === 'assumption' && 'ðŸ§  Analysis Results:'}
                </h4>
                <div className="space-y-3">
                  {analysis.assumptions.map((assumption, index) => (
                    <div key={index} className="bg-muted/50 p-3 rounded-lg">
                      <p className="text-foreground">{assumption}</p>
                    </div>
                  ))}
                </div>
              </div>
            ) : null}
          </div>
        )}

        {/* Action Buttons */}
        <div className="flex justify-between items-center">
          <Button 
            variant="outline" 
            onClick={onBack}
            className="flex items-center gap-2"
          >
            <ArrowLeft className="w-4 h-4" />
            Back to CPS Builder
          </Button>
          
          <div className="text-center">
            <p className="text-sm text-muted-foreground mb-2">
              Feel like tweaking your answers? No problem! Click "Back to CPS Builder" to revisit your Customer, Problem, and Solution statement.
            </p>
          </div>

          <Button 
            onClick={onNext}
            className="bg-primary hover:bg-primary/90"
          >
            Next Step
          </Button>
        </div>
        
        <div className="text-center mt-4">
          <p className="text-sm text-muted-foreground">
            Ready to move to the next phase? Click "Next Step" to get actionable insights based on your answers in the CPS Hypothesis Builder and continue strengthening your framework.
          </p>
        </div>
      </div>
    </div>
  );
};

export default LeapOfFaithBuilder;